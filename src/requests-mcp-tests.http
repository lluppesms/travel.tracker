# MCP (Model Context Protocol) JSON-RPC Tests
# Tests for the MCP server endpoints using JSON-RPC 2.0 protocol

# Variables
@baseServer = https://localhost:7134/api/mcp
@apiKey = myapikey
@userId = 1
@userEmail = lyleluppes@microsoft.com


### 1. List all available MCP tools
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}
X-User-Id: {{userId}}
X-User-Email: {{userEmail}}

{
   "jsonrpc": "2.0",
   "id": 1,
   "method": "tools/list",
   "params": {}
}

### 2. Call Time Tool - Get current time (UTC and local)
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 2,
   "method": "tools/call",
   "params": {
      "name": "GetCurrentTime",
      "arguments": {}
   }
}

### 3. Call Weather Tool - Get forecast for Washington DC coordinates
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 3,
   "method": "tools/call",
   "params": {
      "name": "GetForecast",
      "arguments": {
         "locationPoint": {
            "latitude": 38.8894,
            "longitude": -77.0352
         }
      }
   }
}

### 4. Call GetAllNationalParks Tool - Get list of all national parks
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 4,
   "method": "tools/call",
   "params": {
      "name": "GetAllNationalParks",
      "arguments": {}
   }
}

###############################################################################
# Location Tools - Requires User Authentication Headers
###############################################################################

### 5. GetAllLocations - Get all locations for the authenticated user
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}
X-User-Id: {{userId}}
X-User-Email: {{userEmail}}

{
   "jsonrpc": "2.0",
   "id": 5,
   "method": "tools/call",
   "params": {
      "name": "get_all_locations",
      "arguments": {}
   }
}

### 6. Call get_all_national_parks Tool - Get list of all locations I've visited
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}
X-User-Id: {{userId}}
X-User-Email: {{userEmail}}

{
   "jsonrpc": "2.0",
   "id": 3,
   "method": "tools/call",
   "params": {
      "name": "get_all_national_parks",
      "arguments": { }
   }
}



### 6. Call Locations Tool - Get list of all locations in one state I've visited
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}
X-User-Id: {{userId}}
X-User-Email: {{userEmail}}

{
   "jsonrpc": "2.0",
   "id": 3,
   "method": "tools/call",
   "params": {
      "name": "get_locations_by_state",
      "arguments": {
         "state": "TX"
      }
   }
}
### 8. GetLocationsByDateRange - Get locations visited in 2024
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}
X-User-Id: {{userId}}
X-User-Email: {{userEmail}}

{
   "jsonrpc": "2.0",
   "id": 8,
   "method": "tools/call",
   "params": {
      "name": "get_locations_by_date_range",
      "arguments": {
         "startDate": "2025-01-01",
         "endDate": "2025-12-31"
      }
   }
}

### 9. GetLocationCountByState - Get count of locations grouped by state
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}
X-User-Id: {{userId}}
X-User-Email: {{userEmail}}

{
   "jsonrpc": "2.0",
   "id": 9,
   "method": "tools/call",
   "params": {
      "name": "get_location_count_by_state",
      "arguments": {}
   }
}

### 7. Invalid method test - Should return error
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 7,
   "method": "invalid/method",
   "params": {}
}

### 8. Missing API key test - Should return 401
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream

{
   "jsonrpc": "2.0",
   "id": 8,
   "method": "tools/list",
   "params": {}
}

### 9. Invalid API key test - Should return 401
POST {{baseServer}}
Content-Type: application/json
Accept: application/json
X-API-Key: invalid-key

{
   "jsonrpc": "2.0",
   "id": 9,
   "method": "tools/list",
   "params": {}
}

### 10. Call tool with invalid arguments - Should return error
POST {{baseServer}}
Content-Type: application/json
Accept: application/json
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 10,
   "method": "tools/call",
   "params": {
      "name": "GetForecast",
      "arguments": {
         "locationPoint": {
            "latitude": "invalid",
            "longitude": "invalid"
         }
      }
   }
}

### 11. Call non-existent tool - Should return error
POST {{baseServer}}
Content-Type: application/json
Accept: application/json
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 11,
   "method": "tools/call",
   "params": {
      "name": "NonExistentTool",
      "arguments": {}
   }
}

### 12. Weather forecast for different location (San Francisco)
POST {{baseServer}}
Content-Type: application/json
Accept: application/json
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 12,
   "method": "tools/call",
   "params": {
      "name": "GetForecast",
      "arguments": {
         "locationPoint": {
            "latitude": 37.7749,
            "longitude": -122.4194
         }
      }
   }
}

### 13. JSON-RPC request without ID (notification) - Should not return response
POST {{baseServer}}
Content-Type: application/json
Accept: application/json
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "method": "tools/list",
   "params": {}
}

### 14. Batch JSON-RPC request - Multiple tools in one request
POST {{baseServer}}
Content-Type: application/json
Accept: application/json
X-API-Key: {{apiKey}}

[
   {
      "jsonrpc": "2.0",
      "id": 14,
      "method": "tools/list",
      "params": {}
   },
   {
      "jsonrpc": "2.0",
      "id": 15,
      "method": "tools/call",
      "params": {
         "name": "GetCurrentTime",
         "arguments": {}
      }
   }
]

### 15. Test with malformed JSON - Should return parse error
POST {{baseServer}}
Content-Type: application/json
Accept: application/json
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 16,
   "method": "tools/list",
   "params": {
}