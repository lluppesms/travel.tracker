# MCP (Model Context Protocol) JSON-RPC Tests
# Tests for the MCP server endpoints using JSON-RPC 2.0 protocol

# Variables
@baseServer = https://localhost:7134/api/mcp
@apiKey = myapikey
@userId = 1
@sampleLocationId = 84
@sampleParkId = 1
@sampleStateCode = TX
@sampleStateName = Texas

### 1. List all available MCP tools
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 1,
   "method": "tools/list",
   "params": {}
}

### 2. Call GetAllNationalParks Tool - Get list of all national parks
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 2,
   "method": "tools/call",
   "params": {
      "name": "get_all_national_parks",
      "arguments": {}
   }
}

###############################################################################
# Location Tools - Requires User Authentication Headers
###############################################################################

### 3. Get all locations the authenticated user has visited
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 3,
   "method": "tools/call",
   "params": {
      "name": "get_all_locations",
      "arguments": {
         "userId": "{{userId}}"
      }
   }
}

### 4. Get list of all locations in one state that have been visited
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 4,
   "method": "tools/call",
   "params": {
      "name": "get_locations_by_state",
      "arguments": {
         "userId": "{{userId}}",
         "state": "{{sampleStateCode}}"
      }
   }
}

### 5. Get locations visited in 2025
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 5,
   "method": "tools/call",
   "params": {
      "name": "get_locations_by_date_range",
      "arguments": {
         "userId": "{{userId}}",
         "startDate": "2025-01-01",
         "endDate": "2025-12-31"
      }
   }
}

### 6. Get number of locations visited for each state
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 6,
   "method": "tools/call",
   "params": {
      "name": "get_location_count_by_state",
      "arguments": {
         "userId": "{{userId}}"
      }
   }
}

### 7. Invalid method test - Should return error
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 7,
   "method": "invalid/method",
   "params": {}
}

### 8. Missing API key test - Should return 401
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream

{
   "jsonrpc": "2.0",
   "id": 8,
   "method": "tools/list",
   "params": {}
}

### 9. Invalid API key test - Should return 401
POST {{baseServer}}
Content-Type: application/json
Accept: application/json
X-API-Key: invalid-key

{
   "jsonrpc": "2.0",
   "id": 9,
   "method": "tools/list",
   "params": {}
}

### 10. Call tool with invalid arguments - Should return error
POST {{baseServer}}
Content-Type: application/json
Accept: application/json
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 10,
   "method": "tools/call",
   "params": {
      "name": "GetForecast",
      "arguments": {
         "locationPoint": {
            "latitude": "invalid",
            "longitude": "invalid"
         }
      }
   }
}

### 11. Call non-existent tool - Should return error
POST {{baseServer}}
Content-Type: application/json
Accept: application/json
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 11,
   "method": "tools/call",
   "params": {
      "name": "NonExistentTool",
      "arguments": {}
   }
}


### 12. Call Time Tool - Get current time (UTC and local)
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 12,
   "method": "tools/call",
   "params": {
      "name": "get_current_time",
      "arguments": {}
   }
}

### 13. Call Weather Tool - Get forecast for Hastings MN coordinates
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 13,
   "method": "tools/call",
   "params": {
      "name": "get_weather_forecast",
      "arguments": {
         "locationPoint": {
            "latitude": 44.7433,
            "longitude": -92.8524
         }
      }
   }
}

### 14. Weather forecast for different location (San Francisco)
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 14,
   "method": "tools/call",
   "params": {
      "name": "get_weather_forecast",
      "arguments": {
         "locationPoint": {
            "latitude": 37.7749,
            "longitude": -122.4194
         }
      }
   }
}

### 15. JSON-RPC request without ID (notification) - Should not return response
POST {{baseServer}}
Content-Type: application/json
Accept: application/json
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "method": "tools/list",
   "params": {}
}

### 16. Batch JSON-RPC request - Multiple tools in one request
POST {{baseServer}}
Content-Type: application/json
Accept: application/json, text/event-stream
X-API-Key: {{apiKey}}

[
   {
      "jsonrpc": "2.0",
      "id": 16,
      "method": "tools/call",
      "params": {
         "name": "get_current_time",
         "arguments": {}
      }
   },
   {
      "jsonrpc": "2.0",
      "id": 17,
      "method": "tools/call",
      "params": {
         "name": "get_weather_forecast",
         "arguments": {}
      }
   }
]

### 18. Test with malformed JSON - Should return parse error
POST {{baseServer}}
Content-Type: application/json
Accept: application/json
X-API-Key: {{apiKey}}

{
   "jsonrpc": "2.0",
   "id": 18,
   "method": "tools/list",
   "params": {
}
